<!--订单列表页面-->
<view class="order-list-container">
  <!-- 订单状态标签 -->
  <view class="status-tabs">
    <view 
      class="tab-item {{currentStatus === '' ? 'active' : ''}}" 
      bind:tap="switchStatus" 
      data-status=""
    >
      全部
    </view>
    <view 
      class="tab-item {{currentStatus === 'pending' ? 'active' : ''}}" 
      bind:tap="switchStatus" 
      data-status="pending"
    >
      待付款
    </view>
    <view 
      class="tab-item {{currentStatus === 'paid' ? 'active' : ''}}" 
      bind:tap="switchStatus" 
      data-status="paid"
    >
      待发货
    </view>
    <view 
      class="tab-item {{currentStatus === 'shipped' ? 'active' : ''}}" 
      bind:tap="switchStatus" 
      data-status="shipped"
    >
      待收货
    </view>
    <view 
      class="tab-item {{currentStatus === 'delivered' ? 'active' : ''}}" 
      bind:tap="switchStatus" 
      data-status="delivered"
    >
      待评价
    </view>
  </view>

  <!-- 订单列表 -->
  <view class="order-list" wx:if="{{!loading && orders.length > 0}}">
    <view class="order-item" wx:for="{{orders}}" wx:key="id">
      <!-- 订单头部 -->
      <view class="order-header">
        <view class="order-info">
          <text class="order-no">订单号：{{item.order_no}}</text>
          <text class="order-time">{{item.created_at}}</text>
        </view>
        <view class="order-status {{item.status}}">{{getStatusText(item.status)}}</view>
      </view>

      <!-- 订单商品 -->
      <view class="order-products">
        <view class="product-item" wx:for="{{item.items}}" wx:key="product_id" wx:for-item="product">
          <image class="product-image" src="{{product.product_image}}" mode="aspectFill"/>
          <view class="product-info">
            <view class="product-name">{{product.product_name}}</view>
            <view class="product-spec" wx:if="{{product.spec_name}}">{{product.spec_name}}</view>
            <view class="product-price">
              <text class="currency">￥</text>
              <text class="price">{{product.price}}</text>
              <text class="quantity">×{{product.quantity}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 订单金额 -->
      <view class="order-amount">
        <text class="amount-label">共{{item.item_count}}件商品</text>
        <text class="amount-value">实付：￥{{item.final_amount}}</text>
      </view>

      <!-- 订单操作 -->
      <view class="order-actions">
        <view class="action-buttons">
          <!-- 待付款状态 -->
          <block wx:if="{{item.status === 'pending'}}">
            <button class="action-btn cancel" bind:tap="cancelOrder" data-id="{{item.id}}">取消订单</button>
            <button class="action-btn primary" bind:tap="payOrder" data-id="{{item.id}}" data-amount="{{item.final_amount}}">立即付款</button>
          </block>
          
          <!-- 待发货状态 -->
          <block wx:elif="{{item.status === 'paid'}}">
            <button class="action-btn" bind:tap="contactService">联系客服</button>
          </block>
          
          <!-- 待收货状态 -->
          <block wx:elif="{{item.status === 'shipped'}}">
            <button class="action-btn" bind:tap="viewLogistics" data-id="{{item.id}}">查看物流</button>
            <button class="action-btn primary" bind:tap="confirmReceive" data-id="{{item.id}}">确认收货</button>
          </block>
          
          <!-- 待评价状态 -->
          <block wx:elif="{{item.status === 'delivered'}}">
            <button class="action-btn" bind:tap="goToReview" data-id="{{item.id}}">评价商品</button>
            <button class="action-btn primary" bind:tap="buyAgain" data-id="{{item.id}}">再次购买</button>
          </block>
          
          <!-- 已完成状态 -->
          <block wx:elif="{{item.status === 'completed'}}">
            <button class="action-btn" bind:tap="deleteOrder" data-id="{{item.id}}">删除订单</button>
            <button class="action-btn primary" bind:tap="buyAgain" data-id="{{item.id}}">再次购买</button>
          </block>
          
          <!-- 已取消状态 -->
          <block wx:elif="{{item.status === 'cancelled'}}">
            <button class="action-btn" bind:tap="deleteOrder" data-id="{{item.id}}">删除订单</button>
            <button class="action-btn primary" bind:tap="buyAgain" data-id="{{item.id}}">再次购买</button>
          </block>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && orders.length === 0}}">
    <image class="empty-image" src="/images/empty-order.png" mode="aspectFit"/>
    <text class="empty-text">暂无相关订单</text>
    <text class="empty-desc">去逛逛，发现更多好物</text>
    <button class="go-shopping-btn" bind:tap="goToIndex">去逛逛</button>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{!loading && hasMore}}">
    <text>上拉加载更多</text>
  </view>

  <!-- 没有更多 -->
  <view class="no-more" wx:if="{{!loading && !hasMore && orders.length > 0}}">
    <text>没有更多订单了</text>
  </view>
</view>

<!-- 取消订单确认弹窗 -->
<view class="cancel-modal" wx:if="{{showCancelModal}}" bind:tap="hideCancelModal">
  <view class="cancel-content" catch:tap="">
    <view class="cancel-title">取消订单</view>
    <view class="cancel-reason">
      <text class="reason-label">取消原因：</text>
      <textarea 
        class="reason-input" 
        placeholder="请选择或输入取消原因" 
        value="{{cancelReason}}"
        bind:input="onCancelReasonInput"
        maxlength="200"
      ></textarea>
    </view>
    <view class="cancel-actions">
      <button class="cancel-btn" bind:tap="hideCancelModal">取消</button>
      <button class="confirm-btn" bind:tap="confirmCancel">确定</button>
    </view>
  </view>
</view>

<!-- 删除订单确认弹窗 -->
<view class="delete-modal" wx:if="{{showDeleteModal}}" bind:tap="hideDeleteModal">
  <view class="delete-content" catch:tap="">
    <view class="delete-title">确认删除</view>
    <view class="delete-message">确定要删除这个订单吗？删除后无法恢复。</view>
    <view class="delete-actions">
      <button class="cancel-btn" bind:tap="hideDeleteModal">取消</button>
      <button class="confirm-btn" bind:tap="confirmDelete">确定</button>
    </view>
  </view>
</view>