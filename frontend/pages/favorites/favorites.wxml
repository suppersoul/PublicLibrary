<!--收藏页面-->
<view class="favorites-container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">我的收藏</text>
    <view class="header-actions">
      <button class="edit-btn" bind:tap="toggleEditMode">
        {{isEditMode ? '完成' : '编辑'}}
      </button>
    </view>
  </view>

  <!-- 收藏商品列表 -->
  <view class="favorites-list" wx:if="{{!loading && favorites.length > 0}}">
    <view class="favorite-item" wx:for="{{favorites}}" wx:key="id">
      <!-- 选择框 -->
      <view class="select-box" wx:if="{{isEditMode}}">
        <view class="checkbox {{item.selected ? 'checked' : ''}}" bind:tap="toggleSelect" data-id="{{item.id}}">
          <text class="check-icon" wx:if="{{item.selected}}">✓</text>
        </view>
      </view>

      <!-- 商品信息 -->
      <view class="product-info" bind:tap="goToProduct" data-id="{{item.product_id}}">
        <image class="product-image" src="{{item.product_image}}" mode="aspectFill"/>
        <view class="product-details">
          <view class="product-name">{{item.product_name}}</view>
          <view class="product-spec" wx:if="{{item.spec_name}}">{{item.spec_name}}</view>
          <view class="product-price">
            <text class="currency">￥</text>
            <text class="price">{{item.price}}</text>
            <text class="original-price" wx:if="{{item.original_price > item.price}}">￥{{item.original_price}}</text>
          </view>
          <view class="product-status">
            <text class="status-text {{item.in_stock ? 'in-stock' : 'out-of-stock'}}">
              {{item.in_stock ? '有货' : '缺货'}}
            </text>
            <text class="collect-time">收藏于 {{item.created_at}}</text>
          </view>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="product-actions">
        <button 
          class="action-btn add-cart" 
          bind:tap="addToCart" 
          data-item="{{item}}"
          disabled="{{!item.in_stock}}"
        >
          加入购物车
        </button>
        <button 
          class="action-btn buy-now" 
          bind:tap="buyNow" 
          data-item="{{item}}"
          disabled="{{!item.in_stock}}"
        >
          立即购买
        </button>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && favorites.length === 0}}">
    <image class="empty-image" src="/images/empty-favorites.png" mode="aspectFit"/>
    <text class="empty-text">暂无收藏商品</text>
    <text class="empty-desc">去逛逛，发现更多好物</text>
    <button class="go-shopping-btn" bind:tap="goToIndex">去逛逛</button>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 批量操作栏 -->
  <view class="batch-actions" wx:if="{{isEditMode && favorites.length > 0}}">
    <view class="select-all">
      <view class="checkbox {{allSelected ? 'checked' : ''}}" bind:tap="toggleSelectAll">
        <text class="check-icon" wx:if="{{allSelected}}">✓</text>
      </view>
      <text class="select-text">全选</text>
    </view>
    <view class="action-buttons">
      <button class="batch-btn delete" bind:tap="batchDelete" disabled="{{!hasSelected}}">
        删除({{selectedCount}})
      </button>
      <button class="batch-btn add-cart" bind:tap="batchAddToCart" disabled="{{!hasSelected}}">
        加入购物车({{selectedCount}})
      </button>
    </view>
  </view>
</view>

<!-- 删除确认弹窗 -->
<view class="delete-modal" wx:if="{{showDeleteModal}}" bind:tap="hideDeleteModal">
  <view class="delete-content" catch:tap="">
    <view class="delete-title">确认删除</view>
    <view class="delete-message">确定要删除选中的收藏商品吗？删除后无法恢复。</view>
    <view class="delete-actions">
      <button class="cancel-btn" bind:tap="hideDeleteModal">取消</button>
      <button class="confirm-btn" bind:tap="confirmDelete">确定</button>
    </view>
  </view>
</view>

<!-- 加入购物车成功提示 -->
<view class="success-toast" wx:if="{{showSuccessToast}}">
  <text class="toast-text">{{successMessage}}</text>
</view>