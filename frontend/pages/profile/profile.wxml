<!--用户资料编辑页面-->
<view class="profile-container">
  <!-- 头像编辑 -->
  <view class="avatar-section">
    <view class="avatar-wrapper" bind:tap="chooseAvatar">
      <image class="user-avatar" src="{{userInfo.avatar || '/images/default-avatar.png'}}" mode="aspectFill"/>
      <view class="avatar-edit">
        <text class="edit-icon">📷</text>
      </view>
    </view>
    <text class="avatar-tip">点击更换头像</text>
  </view>

  <!-- 基本信息 -->
  <view class="info-section">
    <view class="section-title">基本信息</view>
    
    <view class="form-item">
      <text class="form-label">昵称</text>
      <input 
        class="form-input" 
        placeholder="请输入昵称" 
        value="{{userInfo.nickname}}"
        bind:input="onNicknameInput"
        maxlength="20"
      />
    </view>

    <view class="form-item">
      <text class="form-label">性别</text>
      <picker 
        class="form-picker" 
        range="{{genderOptions}}" 
        value="{{genderIndex}}"
        bind:change="onGenderChange"
      >
        <view class="picker-text">{{genderOptions[genderIndex]}}</view>
      </picker>
      <text class="arrow">></text>
    </view>

    <view class="form-item">
      <text class="form-label">生日</text>
      <picker 
        class="form-picker" 
        mode="date" 
        value="{{userInfo.birthday}}"
        bind:change="onBirthdayChange"
      >
        <view class="picker-text">{{userInfo.birthday || '请选择生日'}}</view>
      </picker>
      <text class="arrow">></text>
    </view>

    <view class="form-item">
      <text class="form-label">手机号</text>
      <view class="phone-wrapper">
        <text class="phone-text">{{userInfo.phone || '未绑定'}}</text>
        <button class="bind-btn" bind:tap="bindPhone" wx:if="{{!userInfo.phone}}">绑定</button>
        <button class="change-btn" bind:tap="changePhone" wx:else>更换</button>
      </view>
    </view>

    <view class="form-item">
      <text class="form-label">邮箱</text>
      <input 
        class="form-input" 
        placeholder="请输入邮箱" 
        value="{{userInfo.email}}"
        bind:input="onEmailInput"
        type="email"
      />
    </view>
  </view>

  <!-- 账户信息 -->
  <view class="account-section">
    <view class="section-title">账户信息</view>
    
    <view class="info-item">
      <text class="info-label">用户ID</text>
      <text class="info-value">{{userInfo.id}}</text>
    </view>

    <view class="info-item">
      <text class="info-label">注册时间</text>
      <text class="info-value">{{userInfo.created_at}}</text>
    </view>

    <view class="info-item">
      <text class="info-label">账户余额</text>
      <view class="balance-wrapper">
        <text class="balance-amount">￥{{userInfo.balance || '0.00'}}</text>
        <button class="recharge-btn" bind:tap="goToRecharge">充值</button>
      </view>
    </view>
  </view>

  <!-- 安全设置 -->
  <view class="security-section">
    <view class="section-title">安全设置</view>
    
    <view class="security-item" bind:tap="changePassword">
      <view class="security-info">
        <text class="security-icon">🔒</text>
        <text class="security-text">修改密码</text>
      </view>
      <text class="arrow">></text>
    </view>

    <view class="security-item" bind:tap="setPaymentPassword">
      <view class="security-info">
        <text class="security-icon">💳</text>
        <text class="security-text">支付密码</text>
      </view>
      <text class="arrow">></text>
    </view>

    <view class="security-item" bind:tap="privacySettings">
      <view class="security-info">
        <text class="security-icon">👁️</text>
        <text class="security-text">隐私设置</text>
      </view>
      <text class="arrow">></text>
    </view>
  </view>

  <!-- 其他设置 -->
  <view class="other-section">
    <view class="section-title">其他设置</view>
    
    <view class="setting-item" bind:tap="notificationSettings">
      <view class="setting-info">
        <text class="setting-icon">🔔</text>
        <text class="setting-text">消息通知</text>
      </view>
      <text class="arrow">></text>
    </view>

    <view class="setting-item" bind:tap="languageSettings">
      <view class="setting-info">
        <text class="setting-icon">🌐</text>
        <text class="setting-text">语言设置</text>
      </view>
      <text class="arrow">></text>
    </view>

    <view class="setting-item" bind:tap="aboutApp">
      <view class="setting-info">
        <text class="setting-icon">ℹ️</text>
        <text class="setting-text">关于应用</text>
      </view>
      <text class="arrow">></text>
    </view>
  </view>
</view>

<!-- 底部保存按钮 -->
<view class="bottom-bar">
  <button class="save-btn" bind:tap="saveProfile" disabled="{{!hasChanges}}">
    保存修改
  </button>
</view>

<!-- 手机绑定弹窗 -->
<view class="phone-modal" wx:if="{{showPhoneModal}}" bind:tap="hidePhoneModal">
  <view class="phone-content" catch:tap="">
    <view class="phone-title">{{userInfo.phone ? '更换手机号' : '绑定手机号'}}</view>
    
    <view class="phone-form">
      <view class="input-group">
        <input 
          class="phone-input" 
          placeholder="请输入手机号" 
          value="{{phoneNumber}}"
          bind:input="onPhoneInput"
          type="number"
          maxlength="11"
        />
      </view>
      
      <view class="input-group">
        <input 
          class="code-input" 
          placeholder="请输入验证码" 
          value="{{verifyCode}}"
          bind:input="onCodeInput"
          type="number"
          maxlength="6"
        />
        <button 
          class="send-code-btn {{canSendCode ? 'active' : 'disabled'}}" 
          bind:tap="sendCode"
          disabled="{{!canSendCode}}"
        >
          {{countdown > 0 ? countdown + 's' : '发送验证码'}}
        </button>
      </view>
    </view>

    <view class="phone-actions">
      <button class="cancel-btn" bind:tap="hidePhoneModal">取消</button>
      <button class="confirm-btn" bind:tap="confirmPhone">确定</button>
    </view>
  </view>
</view>

<!-- 修改密码弹窗 -->
<view class="password-modal" wx:if="{{showPasswordModal}}" bind:tap="hidePasswordModal">
  <view class="password-content" catch:tap="">
    <view class="password-title">修改密码</view>
    
    <view class="password-form">
      <view class="input-group">
        <input 
          class="password-input" 
          placeholder="请输入原密码" 
          value="{{oldPassword}}"
          bind:input="onOldPasswordInput"
          type="password"
        />
      </view>
      
      <view class="input-group">
        <input 
          class="password-input" 
          placeholder="请输入新密码" 
          value="{{newPassword}}"
          bind:input="onNewPasswordInput"
          type="password"
        />
      </view>
      
      <view class="input-group">
        <input 
          class="password-input" 
          placeholder="请确认新密码" 
          value="{{confirmPassword}}"
          bind:input="onConfirmPasswordInput"
          type="password"
        />
      </view>
    </view>

    <view class="password-actions">
      <button class="cancel-btn" bind:tap="hidePasswordModal">取消</button>
      <button class="confirm-btn" bind:tap="confirmPassword">确定</button>
    </view>
  </view>
</view>

<!-- 加载状态 -->
<view class="loading" wx:if="{{loading}}">
  <text>保存中...</text>
</view>