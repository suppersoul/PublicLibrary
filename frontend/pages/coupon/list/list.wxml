<!--优惠券列表页面-->
<view class="coupon-container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">我的优惠券</text>
  </view>

  <!-- 状态切换标签 -->
  <view class="status-tabs">
    <view 
      class="tab-item {{currentStatus === 'all' ? 'active' : ''}}" 
      bind:tap="switchStatus" 
      data-status="all"
    >
      全部
    </view>
    <view 
      class="tab-item {{currentStatus === 'available' ? 'active' : ''}}" 
      bind:tap="switchStatus" 
      data-status="available"
    >
      可使用
    </view>
    <view 
      class="tab-item {{currentStatus === 'used' ? 'active' : ''}}" 
      bind:tap="switchStatus" 
      data-status="used"
    >
      已使用
    </view>
    <view 
      class="tab-item {{currentStatus === 'expired' ? 'active' : ''}}" 
      bind:tap="switchStatus" 
      data-status="expired"
    >
      已过期
    </view>
  </view>

  <!-- 优惠券列表 -->
  <view class="coupon-list" wx:if="{{!loading && coupons.length > 0}}">
    <view class="coupon-item {{item.status === 'used' ? 'used' : ''}} {{item.status === 'expired' ? 'expired' : ''}}" 
          wx:for="{{coupons}}" wx:key="id">
      
      <!-- 优惠券左侧 -->
      <view class="coupon-left">
        <view class="coupon-amount">
          <text class="currency">￥</text>
          <text class="amount">{{item.discount_amount}}</text>
        </view>
        <view class="coupon-type">{{item.type === 'discount' ? '满减券' : '折扣券'}}</view>
        <view class="coupon-condition" wx:if="{{item.min_amount > 0}}">
          满{{item.min_amount}}可用
        </view>
      </view>

      <!-- 优惠券右侧 -->
      <view class="coupon-right">
        <view class="coupon-name">{{item.name}}</view>
        <view class="coupon-desc">{{item.description}}</view>
        <view class="coupon-validity">
          <text class="validity-label">有效期至：</text>
          <text class="validity-date">{{item.expire_date}}</text>
        </view>
        
        <!-- 使用说明 -->
        <view class="coupon-usage" wx:if="{{item.usage_instructions}}">
          <text class="usage-label">使用说明：</text>
          <text class="usage-text">{{item.usage_instructions}}</text>
        </view>

        <!-- 状态标签 -->
        <view class="status-tag">
          <text class="status-text {{item.status}}">
            {{getStatusText(item.status)}}
          </text>
        </view>

        <!-- 操作按钮 -->
        <view class="coupon-actions" wx:if="{{item.status === 'available'}}">
          <button class="action-btn use-btn" bind:tap="useCoupon" data-coupon="{{item}}">
            立即使用
          </button>
        </view>
      </view>

      <!-- 优惠券状态遮罩 -->
      <view class="coupon-mask" wx:if="{{item.status === 'used' || item.status === 'expired'}}">
        <text class="mask-text">{{getStatusText(item.status)}}</text>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && coupons.length === 0}}">
    <image class="empty-image" src="/images/empty-coupon.png" mode="aspectFit"/>
    <text class="empty-text">暂无优惠券</text>
    <text class="empty-desc">去逛逛，发现更多优惠</text>
    <button class="go-shopping-btn" bind:tap="goToIndex">去逛逛</button>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{!loading && hasMore}}">
    <text class="load-more-text" bind:tap="loadMore">加载更多</text>
  </view>

  <!-- 没有更多 -->
  <view class="no-more" wx:if="{{!loading && !hasMore && coupons.length > 0}}">
    <text class="no-more-text">没有更多了</text>
  </view>
</view>

<!-- 优惠券使用确认弹窗 -->
<view class="use-modal" wx:if="{{showUseModal}}" bind:tap="hideUseModal">
  <view class="use-content" catch:tap="">
    <view class="use-title">使用优惠券</view>
    <view class="use-info">
      <text class="coupon-name">{{selectedCoupon.name}}</text>
      <text class="coupon-desc">{{selectedCoupon.description}}</text>
      <text class="coupon-amount">优惠金额：￥{{selectedCoupon.discount_amount}}</text>
    </view>
    <view class="use-actions">
      <button class="cancel-btn" bind:tap="hideUseModal">取消</button>
      <button class="confirm-btn" bind:tap="confirmUseCoupon">确认使用</button>
    </view>
  </view>
</view>